<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wok & Bara</title>
  <style>
    :root{
      --left-width:260px;
      --gap:16px;
      --accent:#0b76ef;
      --bg:#f6f7fb;
      --card:#ffffff;
      --muted:#666;
      --tax-rate:0.06; /* used in script */
    }

    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;color:#222;background:var(--bg)}

    /* main 2-column layout */
    .app{
      display:flex;
      height:100vh;
      gap:var(--gap);
      padding:var(--gap);
      box-sizing:border-box;
    }

    /* left fixed column for categories */
    .sidebar{
      width:var(--left-width);
      min-width:var(--left-width);
      max-width:var(--left-width);
      background:var(--card);
      border-radius:12px;
      padding:12px;
      box-shadow:0 6px 20px rgba(12,20,40,0.06);
      display:flex;
      flex-direction:column;
      gap:10px;
      box-sizing:border-box;
      overflow:hidden; /* vertical unscrollable list requirement */
    }

    .categories{
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .category{
      display:flex;
      gap:8px;
      align-items:center;
      padding:8px;
      border-radius:8px;
      cursor:pointer;
      user-select:none;
    }
    .category.active{background:linear-gradient(90deg, rgba(11,118,239,0.12), rgba(11,118,239,0.06));}

    .cat-thumb{width:44px;height:44px;border-radius:8px;flex-shrink:0;object-fit:cover;background:#eee}
    .cat-meta{display:flex;flex-direction:column}
    .cat-label{font-weight:600}
    .cat-count{font-size:12px;color:var(--muted)}

    /* main content (right) is flexible */
    .main{
      flex:1 1 auto;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-width:0;
    }

    /* header area (optional) */
    .topbar{display:flex;align-items:center;justify-content:space-between;padding:8px}

    /* products grid */
    .products-area{
      background:var(--card);
      border-radius:12px;
      padding:12px;
      box-shadow:0 6px 20px rgba(12,20,40,0.04);
      flex:1 1 auto;
      display:flex;
      flex-direction:column;
      min-height:0; /* allow inner scroll */
    }

    .products-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(180px, 1fr)); /* flexible number of columns */
      gap:12px;
      align-items:start;
      overflow:auto;
      padding:4px;
      min-height:0;
    }

    .product-card{
      background:#fff;border-radius:10px;padding:10px;display:flex;flex-direction:column;gap:8px;box-shadow:0 6px 12px rgba(12,20,40,0.04);
    }
    .product-thumb{width:100%;height:120px;border-radius:8px;object-fit:cover;cursor:pointer}
    .product-meta{display:flex;flex-direction:column;gap:6px}
    .product-title{font-weight:600}
    .product-price{font-size:14px;color:var(--muted)}
    .product-selected{margin-top:auto;display:flex;justify-content:space-between;align-items:center}

    .qty-badge{background:#eee;padding:6px 8px;border-radius:999px;font-weight:600}

    /* bottom bar */
    .bottombar{
      height:66px;
      display:flex;align-items:center;justify-content:space-between;padding:12px;background:linear-gradient(90deg,#ffffff, #fbfdff);border-radius:12px;box-shadow:0 -2px 12px rgba(12,20,40,0.03);
    }
    .bottombar .summary{display:flex;gap:18px;align-items:center}
    .checkout-btn{background:var(--accent);color:#fff;padding:12px 20px;border-radius:10px;border:none;font-weight:700;cursor:pointer}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.4);display:none;align-items:center;justify-content:center;z-index:90}
    .modal{background:#fff;border-radius:12px;max-width:920px;width:95%;max-height:92vh;overflow:auto;padding:18px;box-shadow:0 18px 60px rgba(2,18,50,0.2)}
    .modal-grid{display:grid;grid-template-columns:360px 1fr;gap:18px}
    .modal-thumb{width:100%;height:300px;object-fit:cover;border-radius:8px}
    .modal-actions{display:flex;gap:8px;align-items:center;margin-top:12px}
    .btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn-ghost{background:#f2f4f8}
    .btn-primary{background:var(--accent);color:#fff}

    .addons-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .addon{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid #f0f0f0}

    /* checkout modal list */
    .checkout-list{display:flex;flex-direction:column;gap:8px}
    .checkout-item{display:flex;gap:8px;align-items:flex-start;padding:8px;border-radius:8px}
    .checkout-thumb{width:56px;height:56px;border-radius:8px;object-fit:cover}

    /* responsiveness tweak */
    @media (max-width:800px){
      :root{--left-width:200px}
      .modal-grid{grid-template-columns:1fr}
      .modal-thumb{height:220px}
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div style="font-weight:700;">Categories</div>
      <div class="categories" id="categories"></div>
      <div style="flex:1"></div>
      <div style="font-size:12px;color:var(--muted);text-align:center">Touch a product to open options</div>
    </aside>

    <main class="main">
      <div class="topbar">
        <div style="font-weight:700">Products</div>
        <div style="font-size:13px;color:var(--muted)">Kiosk: Self-service</div>
      </div>

      <section class="products-area">
        <div class="products-grid" id="productsGrid"></div>
      </section>

      <div class="bottombar">
        <div class="summary">
          <div id="itemCount">0 items</div>
          <div id="totalPrice">RM 0.00</div>
        </div>
        <div>
          <button class="checkout-btn" id="checkoutBtn">Checkout</button>
        </div>
      </div>
    </main>
  </div>

  <!-- product modal -->
  <div class="modal-backdrop" id="productModal">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="font-weight:700" id="modalTitle">Product</div>
        <button class="btn btn-ghost" onclick="closeProductModal()">CLOSE</button>
      </div>
      <div class="modal-grid">
        <div>
          <img id="modalImage" class="modal-thumb" src="" alt="">
        </div>
        <div>
          <div id="modalDesc" style="color:var(--muted)"></div>
          <div style="margin-top:10px;font-weight:700;font-size:18px" id="modalUnitPrice">RM 0.00</div>

          <div style="display:flex;gap:8px;align-items:center;margin-top:16px">
            <button class="btn" id="decBtn">-</button>
            <div id="modalQty" style="min-width:36px;text-align:center;font-weight:700">1</div>
            <button class="btn" id="incBtn">+</button>
            <div style="margin-left:12px;color:var(--muted)">Total: <span id="modalTotalPrice">RM 0.00</span></div>
          </div>

          <div style="margin-top:12px">
            <label style="font-weight:700">Note</label>
            <textarea id="modalNote" placeholder="Add note (e.g. no onion)" style="width:100%;min-height:64px;margin-top:6px;padding:8px;border-radius:8px;border:1px solid #eee"></textarea>
          </div>

          <div style="margin-top:12px">
            <div style="font-weight:700">Add-ons</div>
            <div class="addons-list" id="modalAddons"></div>
          </div>

          <div class="modal-actions">
            <button class="btn btn-ghost" onclick="closeProductModal()">CANCEL</button>
            <button class="btn btn-primary" id="confirmProductBtn">CONFIRM</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- checkout modal -->
  <div class="modal-backdrop" id="checkoutModal">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="font-weight:700">Checkout</div>
        <button class="btn btn-ghost" onclick="closeCheckoutModal()">CLOSE</button>
      </div>

      <div class="checkout-list" id="checkoutList"></div>

      <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">Total (incl. tax)</div>
        <div style="font-weight:800" id="checkoutTotal">RM 0.00</div>
      </div>

      <div style="display:flex;justify-content:flex-end;margin-top:12px">
        <button class="btn btn-primary" onclick="finalizeCheckout()">CHECKOUT</button>
      </div>

    </div>
  </div>

  <script>
    /* Sample data */
    const TAX_RATE = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--tax-rate')) || 0.06;

    const categories = [
      {id:'c1',label:'Burgers',img:'https://picsum.photos/seed/b1/120/120'},
      {id:'c2',label:'Pizza',img:'https://picsum.photos/seed/p1/120/120'},
      {id:'c3',label:'Drinks',img:'https://picsum.photos/seed/d1/120/120'},
      {id:'c4',label:'Desserts',img:'https://picsum.photos/seed/s1/120/120'}
    ];

    const products = [
      {id:'p1',cat:'c1',label:'Cheeseburger',price:9.50,img:'https://picsum.photos/seed/cheese/400/300',desc:'Juicy beef patty with cheese.',addons:[{id:'a1',label:'Extra Cheese',price:1.2},{id:'a2',label:'Bacon',price:2.5}]},
      {id:'p2',cat:'c1',label:'Veggie Burger',price:8.00,img:'https://picsum.photos/seed/veggie/400/300',desc:'Grilled veg patty, fresh salad.',addons:[]},
      {id:'p3',cat:'c2',label:'Margherita',price:18.00,img:'https://picsum.photos/seed/mar/400/300',desc:'Classic margherita with basil.',addons:[{id:'a3',label:'Extra Cheese',price:2},{id:'a4',label:'Olives',price:1}]},
      {id:'p4',cat:'c3',label:'Iced Tea',price:3.50,img:'https://picsum.photos/seed/tea/400/300',desc:'Refreshing cold tea.',addons:[]},
      {id:'p5',cat:'c4',label:'Chocolate Cake',price:6.50,img:'https://picsum.photos/seed/cake/400/300',desc:'Rich chocolate slice.',addons:[{id:'a5',label:'Vanilla Icecream',price:1.5}]}
    ];

    /* cart: map productId -> {product, qty, addons: [ids], note} */
    const cart = new Map();
    let activeCategory = categories[0].id;

    function $(id){return document.getElementById(id)}

    function currency(v){return 'RM '+(v).toFixed(2)}

    function renderCategories(){
      const wrap = $('categories');
      wrap.innerHTML='';
      categories.forEach(cat=>{
        const el = document.createElement('div');
        el.className = 'category' + (cat.id===activeCategory ? ' active' : '');
        el.onclick = ()=>{activeCategory=cat.id; renderCategories(); renderProducts();};
        el.innerHTML = `
          <img class="cat-thumb" src="${cat.img}" alt="">
          <div class="cat-meta">
            <div class="cat-label">${cat.label}</div>
            <div class="cat-count">${countSelectedForCategory(cat.id)} selected</div>
          </div>
        `;
        wrap.appendChild(el);
      })
    }

    function countSelectedForCategory(catId){
      let sum=0;
      cart.forEach(item=>{ if(item.product.cat===catId) sum+=item.qty })
      return sum;
    }

    function renderProducts(){
      const grid = $('productsGrid');
      grid.innerHTML='';
      const list = products.filter(p=>p.cat===activeCategory);
      list.forEach(p=>{
        const card = document.createElement('div');
        card.className='product-card';
        const inCart = cart.get(p.id);
        const selectedCount = inCart ? inCart.qty : 0;
        card.innerHTML = `
          <img class="product-thumb" src="${p.img}" alt="" onclick="openProductModal('${p.id}')">
          <div class="product-meta">
            <div class="product-title">${p.label}</div>
            <div class="product-price">${currency(p.price)}</div>
            <div class="product-selected">
              <div style="font-size:13px;color:var(--muted)">Total: <strong>${selectedCount}</strong></div>
              <div></div>
            </div>
          </div>
        `;
        grid.appendChild(card);
      })
    }

    function updateBottomBar(){
      let items=0; let total=0;
      cart.forEach(it=>{ items+=it.qty; total += itemTotal(it) });
      $('itemCount').textContent = items + (items===1 ? ' item' : ' items');
      $('totalPrice').textContent = currency(total);
      $('checkoutBtn').disabled = items===0;
    }

    function itemTotal(cartItem){
      const base = cartItem.product.price * cartItem.qty;
      const addonsSum = (cartItem.addons||[]).reduce((s,aid)=>{
        const ad = cartItem.product.addons.find(a=>a.id===aid);
        return s + (ad?ad.price:0);
      },0);
      return base + addonsSum * cartItem.qty;
    }

    /* product modal logic */
    let modalState = null; // {product, qty, selectedAddons:[],note}
    function openProductModal(productId){
      const p = products.find(x=>x.id===productId);
      const inCart = cart.get(productId);
      modalState = {product:p, qty: inCart ? inCart.qty : 1, selectedAddons: inCart ? [...inCart.addons] : [], note: inCart ? inCart.note : ''};
      $('modalTitle').textContent = p.label;
      $('modalImage').src = p.img;
      $('modalDesc').textContent = p.desc;
      $('modalUnitPrice').textContent = currency(p.price);
      $('modalQty').textContent = modalState.qty;
      $('modalNote').value = modalState.note || '';
      renderModalAddons();
      updateModalTotal();
      $('productModal').style.display='flex';
      $('incBtn').onclick = ()=>{ modalState.qty++; $('modalQty').textContent=modalState.qty; updateModalTotal(); }
      $('decBtn').onclick = ()=>{ if(modalState.qty>1) modalState.qty--; $('modalQty').textContent=modalState.qty; updateModalTotal(); }
      $('confirmProductBtn').onclick = confirmProductFromModal;
    }

    function renderModalAddons(){
      const wrap = $('modalAddons'); wrap.innerHTML='';
      const list = modalState.product.addons || [];
      if(list.length===0){ wrap.innerHTML = '<div style="color:var(--muted);font-size:13px">No addons</div>'; return }
      list.forEach(a=>{
        const row = document.createElement('label'); row.className='addon';
        const checked = modalState.selectedAddons.includes(a.id) ? 'checked' : '';
        row.innerHTML = `<div><input type=checkbox ${checked} onchange="toggleAddon('${a.id}')"> ${a.label}</div><div>${currency(a.price)}</div>`;
        wrap.appendChild(row);
      })
    }

    function toggleAddon(addonId){
      const idx = modalState.selectedAddons.indexOf(addonId);
      if(idx===-1) modalState.selectedAddons.push(addonId); else modalState.selectedAddons.splice(idx,1);
      updateModalTotal();
    }

    function updateModalTotal(){
      const unit = modalState.product.price;
      const addonsSum = (modalState.product.addons||[]).filter(a=>modalState.selectedAddons.includes(a.id)).reduce((s,a)=>s+a.price,0);
      const total = (unit + addonsSum) * modalState.qty;
      $('modalTotalPrice').textContent = currency(total);
    }

    function closeProductModal(){ $('productModal').style.display='none'; modalState=null }

    function confirmProductFromModal(){
      const p = modalState.product;
      const entry = {product:p, qty:modalState.qty, addons:[...modalState.selectedAddons], note: $('modalNote').value || ''};
      cart.set(p.id, entry);
      closeProductModal();
      renderCategories(); renderProducts(); updateBottomBar();
    }

    /* Checkout modal */
    function openCheckoutModal(){
      const wrap = $('checkoutList'); wrap.innerHTML='';
      let subtotal=0;
      cart.forEach(it=>{
        const el = document.createElement('div'); el.className='checkout-item';
        const addonsText = (it.addons||[]).map(aid=>{ const a = it.product.addons.find(x=>x.id===aid); return a? a.label+" ("+currency(a.price)+")":"" }).join(', ');
        el.innerHTML = `
          <img class="checkout-thumb" src="${it.product.img}">
          <div style="flex:1">
            <div style="font-weight:700">${it.product.label} <span style="font-weight:600;color:var(--muted)">x ${it.qty}</span></div>
            <div style="font-size:13px;color:var(--muted)">${addonsText || ''}</div>
            <div style="font-size:13px;color:var(--muted)">Note: ${it.note || '-'}</div>
          </div>
          <div style="font-weight:800">${currency(itemTotal(it))}</div>
        `;
        wrap.appendChild(el);
        subtotal += itemTotal(it);
      })
      const tax = subtotal * TAX_RATE;
      const total = subtotal + tax;
      $('checkoutTotal').textContent = currency(total);
      $('checkoutModal').style.display='flex';
    }

    function closeCheckoutModal(){ $('checkoutModal').style.display='none' }

    function finalizeCheckout(){
      // placeholder behavior - Checkout page KIV
      alert('Checkout flow is KIV (keep in view).\nOrder summary shown here.');
    }

    /* wire checkout button */
    $('checkoutBtn').addEventListener('click', openCheckoutModal);

    /* initialize */
    renderCategories(); renderProducts(); updateBottomBar();

    // allow clicking backdrop to close modals
    document.querySelectorAll('.modal-backdrop').forEach(b=>{
      b.addEventListener('click', (e)=>{ if(e.target===b) b.style.display='none' })
    })
  </script>
</body>
</html>
